<!DOCTYPE html>
<html>
<head><title>PING JERS PHONE</title></head>
<body>
    <div id="onlineElements" style="display:none;">
        {% if username %}
            <p>You are logged in as {{ username }}.</p>
        {% else %}
            <p>If you are not logged in, you will ping anonymously.</p>
        {% endif %}
        <button onclick="pingJer()" id="pingButton">Ping Jer!</button>
    </div>

    <p>System Status</p>
    <div id="statusLight" style="width: 20px; height: 20px; border-radius: 50%; display: inline-block;"></div>
    


    <footer>
        {% if username %}
            <p>Logged in as: {{ username }}</p>
            <a href="/logout">Logout</a>
        {% else %}
            <a href="/login">Login</a>
        {% endif %}
        {% if username == 'admin' %}
        <a href="/admin">Go to Admin Page</a>
        {% endif %}
    </footer>

<script>
    function updateStatus() {
        fetch('/status')
            .then(response => response.json())
            .then(data => {
                let displayValue = data.online ? 'block' : 'none';
                document.getElementById('onlineElements').style.display = displayValue;
                document.getElementById('statusLight').style.backgroundColor = data.online ? 'green' : 'red';
            });
    }

    function pingJer() {
        let name;
        {% if username %}
            name = "{{ username }}";
        {% else %}
            name = "Anon Pinger";
        {% endif %}

        fetch('/ping', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name: name })
        }).then(response => response.json()).then(data => {
            if (data.status === 'success') {
                alert('Ping Successful');
            } else {
                alert('Ping Failed');
            }
        });
    }

    document.addEventListener('DOMContentLoaded', (event) => {
        updateStatus();
    });
</script>
</body>
</html>

